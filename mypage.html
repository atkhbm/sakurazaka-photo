<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>マイページ | 櫻坂46 生写真交換サイト</title>
  <style>
    body { font-family: 'Helvetica Neue', system-ui, -apple-system, Segoe UI, Roboto, 'Hiragino Kaku Gothic ProN', 'Noto Sans JP', 'Yu Gothic', sans-serif; background:#f9f9fb; margin:0; color:#333; }
    header { background:#fff; display:flex; justify-content:space-between; align-items:center; padding:16px 20px; border-bottom:1px solid #ddd; }
    header h1 { margin:0; font-size:1.2rem; color:#c81d5f; }
    nav a { margin-left: 16px; text-decoration:none; color:#555; font-weight:bold; }
    nav a:hover { color:#c81d5f; }
    .wrap { max-width: 880px; margin: 32px auto; padding: 0 16px; }
    .card { background:#fff; padding:20px; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,.06); }
    h2 { margin:0 0 12px; }
    .grid { display:grid; gap:16px; grid-template-columns: 1fr; }
    .actions { margin-top:18px; display:flex; gap:12px; flex-wrap:wrap; }
    .btn { background:#c81d5f; color:#fff; border:none; padding:10px 16px; border-radius:8px; cursor:pointer; font-weight:bold; text-decoration:none; display:inline-block; }
    .btn:hover { background:#a9134a; }
    .muted { color:#666; }
    dt { font-weight:bold; }
    dd { margin: 0 0 8px 0; }
  </style>
</head>
<body>
  <header>
    <h1>マイページ</h1>
    <nav data-auth-links></nav>
  </header>

  <main class="wrap">
    <section class="card grid">
      <div>
        <h2 id="welcome">ようこそ！</h2>
        <p class="muted">ここからマイリスト管理やコレクションの確認ができます。</p>
      </div>

      <div>
        <h3>プロフィール</h3>
        <dl>
          <dt>ニックネーム</dt>
          <dd id="profile-name">-</dd>
          <dt>メールアドレス</dt>
          <dd id="profile-email">-</dd>
          <dt>X（旧Twitter）</dt>
          <dd id="profile-x">-</dd>
          <dt>Instagram</dt>
          <dd id="profile-ig">-</dd>
        </dl>
      </div>

      <div class="actions">
        <a class="btn" href="mylist_manage.html">マイリストを管理</a>
        <a class="btn" href="search.html">生写真を探す</a>
      </div>
    </section>
  </main>

  <script src="auth.js"></script>
  <script>
    // ログイン必須
    const session = requireAuth("login.html");

    // ヘッダー出し分け
    if (typeof renderHeaderAuthLinks === "function") renderHeaderAuthLinks();

    // localStorage からSNSを含むユーザー詳細を取得
    (function loadProfile(){
      try {
        const users = JSON.parse(localStorage.getItem("app_users") || "[]");
        const me = users.find(u => (u.email || '').toLowerCase() === (session.email || '').toLowerCase());
        const name = me?.displayName || "-";
        const email = me?.email || "-";
        const xId = me?.sns?.x?.id || "";
        const xVis = me?.sns?.x?.visibility || "match_only";
        const igId = me?.sns?.instagram?.id || "";
        const igVis = me?.sns?.instagram?.visibility || "match_only";

        document.getElementById("welcome").textContent = `${name} さん、ようこそ！`;
        document.getElementById("profile-name").textContent = name;
        document.getElementById("profile-email").textContent = email;

        // マイページなので本人にはフル表示（公開範囲の表示は参考まで）
        document.getElementById("profile-x").innerHTML =
          xId ? `${xId} <span class="muted">（公開範囲: ${labelVis(xVis)}）</span>` : "-";
        document.getElementById("profile-ig").innerHTML =
          igId ? `${igId} <span class="muted">（公開範囲: ${labelVis(igVis)}）</span>` : "-";
      } catch(e) {
        console.warn(e);
      }
    })();

    function labelVis(v){
      switch(v){
        case "public": return "常に表示";
        case "private": return "非公開";
        default: return "マッチ後のみ表示";
      }
    }
  </script>
</body>
</html>
